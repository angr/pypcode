name: Build

on: [push, pull_request]

jobs:
  BuildAndTest:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-20.04, ubuntu-18.04,
             macos-10.15,
             windows-2019, windows-2016]
        py: [ '3.x', 'pypy-3.7' ]
    steps:
    - name: Clone Tree
      uses: actions/checkout@v2
    - name: Setup Python
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.py }}
        architecture: x64 # Windows actually gets 32b pypy
    - name: Install Dependencies
      run: |
        python -m pip install -U pip setuptools
    - name: Install
      run: |
        python -m pip install --user -v .
    - name: Test
      run: |
        mkdir tmp
        cd tmp

        python -m pypcode -l
        python -c "import base64; open('test-x64.bin', 'wb').write(base64.b64decode('McA5xnYRSInBg+EfigwKMAwHSP/A6+vD'))"
        python -m pypcode x86:LE:64:default test-x64.bin
